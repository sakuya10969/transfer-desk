# 機能詳細仕様

## 1. ダッシュボード

- **目的**: システム全体の主要指標と最近の活動を一目で把握する。
- **入力**: なし（自動集計）。
- **出力**:
  - 全クラブ数、全選手数、全契約数、全移籍件数。
  - 最近更新されたクラブ（5件）。
  - 最近追加された選手（5件）。
  - 最近の移籍履歴（5件）。
- **バリデーション**: なし。
- **エッジケース**: データが0件の場合、適切なEmpty Stateを表示する。
- **依存関係**: すべての主要エンティティ（Clubs, Players, Contracts, Transfers）。

## 2. クラブ管理

- **目的**: サッカークラブ情報の管理。
- **入力**:
  - 必須: `name` (クラブ名)
  - 任意: `country`, `league`, `founded_year`, `stadium`
- **出力**: クラブ情報、所属選手リスト。
- **バリデーション**:
  - `name`: 必須、空文字不可。
  - `founded_year`: 数値、妥当な西暦であること（現在年以下など）。
- **エッジケース**:
  - 同名クラブの登録（システム上は許可されるが、運用上注意）。
  - 所属選手がいる状態での削除（外部キー制約によりエラーまたはカスケード設定が必要。デフォルトはエラー）。
- **依存関係**: `transfers`, `contracts`, `players`.

## 3. 選手管理

- **目的**: 選手情報の管理。
- **入力**:
  - 必須: `first_name`, `last_name`
  - 任意: `position`, `date_of_birth`, `nationality`, `current_club_id`
- **出力**: 選手プロフィール、契約履歴、移籍履歴、通算成績。
- **バリデーション**:
  - 必須項目の入力チェック。
- **エッジケース**:
  - 無所属の選手（`current_club_id` が null）。
- **依存関係**: `clubs` (所属先).

## 4. 契約管理

- **目的**: 選手とクラブ間の契約条件の管理。
- **入力**:
  - 必須: `player_id`, `club_id`, `start_date`
  - 任意: `end_date`, `salary`, `buyout_clause`
- **出力**: 契約詳細。
- **バリデーション**:
  - `end_date` は `start_date` より後であること。
  - 選手とクラブが存在すること。
- **エッジケース**:
  - 重複期間の契約（バリデーションで警告または許可しないことが望ましい）。
- **依存関係**: `players`, `clubs`.

## 5. 移籍管理

- **目的**: 選手の移籍履歴の管理。
- **入力**:
  - 必須: `player_id`, `from_club_id`, `to_club_id`, `transfer_date`
  - 任意: `transfer_fee`, `transfer_type` (完全/レンタル等)
- **出力**: 移籍詳細。
- **バリデーション**:
  - 移籍元と移籍先が異なること。
  - `transfer_date` が妥当であること。
- **エッジケース**:
  - 移籍と同時に現在の所属クラブ情報を更新するかどうかの整合性（アプリ側で制御）。
- **依存関係**: `players`, `clubs`.

## 6. 成績管理

- **目的**: 選手のシーズンごとの成績管理。
- **入力**:
  - 必須: `player_id`, `club_id`, `season` (例: "2023-24")
  - 任意: `matches_played`, `goals`, `assists`, `yellow_cards`, `red_cards`
- **出力**: 成績データ。
- **バリデーション**:
  - 数値項目は0以上。
  - `(season, player_id, club_id)` の組み合わせはユニーク。
- **エッジケース**:
  - シーズン途中の移籍による複数クラブでの成績記録。
- **依存関係**: `players`, `clubs`.

## 7. 設定（CSVインポート）

- **目的**: クラブデータの一括登録。
- **入力**: CSVファイル。
  - ヘッダー仕様: `name` (必須), `country`, `league`, `founded_year`, `stadium`.
- **出力**: インポート成功/失敗の結果通知。
- **バリデーション**:
  - ファイル形式がCSVであること。
  - 必須カラム `name` が存在すること。
  - 各行のデータ形式チェック。
- **エッジケース**:
  - 巨大なCSVファイルのアップロード（タイムアウト考慮、現状は数百件程度を想定）。
  - 文字コード（UTF-8推奨）。
- **依存関係**: `clubs` テーブルへの直接Insert。
