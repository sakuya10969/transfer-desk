# Source of Truth (唯一の事実)

## プロダクトの目的

**TransferDesk** は、サッカークラブにおける「クラブ」「選手」「契約」「移籍」「成績」の情報を一元管理し、データの分散や管理コストを削減するための業務アプリケーションです。

分散しがちなチーム編成データや移籍履歴を一つのプラットフォームに集約し、直感的なダッシュボードと検索機能を提供することで、クラブ運営やスカウティング業務の効率化を支援します。

## スコープ

### 含まれるもの (In-Scope)

- **ダッシュボード機能**: 全体の統計情報の可視化
- **基本情報のCRUD**: クラブ、選手、契約、移籍、成績データの登録・参照・更新・削除
- **検索・フィルタリング**: 名前検索、ポジション、シーズン、年による絞り込み
- **一括登録**: CSVによるクラブ情報のインポート
- **設定**: 表示テーマ（ライト/ダーク）の切り替え

### 含まれないもの (Out-Scope)

- **複雑な分析**: 高度なセイバーメトリクスや予測分析
- **試合シミュレーション**: 試合結果の自動生成や戦術シミュレーション
- **外部API連携**: 実際の移籍市場データAPIとのリアルタイム同期（現状は手動/CSVのみ）
- **詳細な権限管理**: 役割ベースのアクセス制御（RBAC）やユーザーログイン機能（MVP段階では簡易的な管理者利用を想定）

## 基本方針

1. **Relay ファースト**: データフェッチと状態管理には Relay を全面的に採用し、コンポーネントとデータ要件のコロケーション（Co-location）を徹底する。
2. **Hasura 駆動**: バックエンドロジックの実装コストを最小化するため、CRUD 操作は Hasura GraphQL Engine に委譲する。
3. **BFF パターン**: クライアントは Hasura に直接接続せず、Next.js の API Route を経由することで、認証情報の隠蔽や将来的なロジック拡張の余地を残す。
4. **Schema 駆動開発**: GraphQL スキーマと Prisma スキーマを正とし、型安全性と整合性を担保する。

## アーキテクチャ上の不変条件

- **単方向データフロー**: クライアント -> BFF -> Hasura -> DB の流れを厳守する。クライアントが直接 DB にアクセスすることは禁止。
- **Prisma は管理用**: アプリケーションの実行時（Runtime）データアクセスには Relay/Hasura を使用し、Prisma Client は使用しない（マイグレーション管理のみ）。
- **`__generated__` の信頼**: Relay Compiler が生成するアーティファクトを手動で修正してはならない。

## 非機能要件

- **性能**: Relay のキャッシュと最適化されたクエリにより、画面遷移時の体感速度を高速に保つ。不要な再レンダリングを防ぐ。
- **保守性**: Tailwind CSS と TypeScript の厳格な型チェックを用い、スタイルの競合や実行時エラーを未然に防ぐ。
- **セキュリティ**: Hasura の Admin Secret はサーバーサイド（Next.js API Routes）でのみ使用し、クライアントには漏洩させない。
