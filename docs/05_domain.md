# ドメインモデル

## エンティティ一覧

### Clubs (クラブ)

チーム情報の基本単位です。

- 属性: ID, 名前, 国, リーグ, 創設年, スタジアム, 作成日時, 更新日時

### Players (選手)

サッカー選手の個人情報です。

- 属性: ID, 名, 姓, 生年月日, 国籍, ポジション, 現在の所属クラブID, 作成日時, 更新日時

### Contracts (契約)

選手とクラブ間の雇用契約を表します。

- 属性: ID, 選手ID, クラブID, 開始日, 終了日, 年俸, バイアウト条項, 作成日時, 更新日時

### Transfers (移籍)

クラブ間での選手の移動履歴を表します。

- 属性: ID, 選手ID, 移籍元クラブID, 移籍先クラブID, 移籍日, 移籍金, タイプ, 作成日時, 更新日時

### Stats (成績)

特定のシーズンにおける選手のパフォーマンス記録です。

- 属性: ID, 選手ID, クラブID, シーズン, 試合数, ゴール数, アシスト数, イエローカード, レッドカード, 作成日時, 更新日時

## 関係性 (ER図概略)

```text
Clubs 1 -- N Players (現在の所属)
Clubs 1 -- N Contracts
Clubs 1 -- N Transfers (移籍元)
Clubs 1 -- N Transfers (移籍先)
Clubs 1 -- N Stats

Players 1 -- N Contracts
Players 1 -- N Transfers
Players 1 -- N Stats
```

## 制約

### ユニーク制約

- **Stats**: `(season, player_id, club_id)`
  - 同一シーズン、同一クラブ、同一選手の成績レコードは一つしか存在できません。

### 必須制約

- **Clubs**: `name` は必須。
- **Players**: `first_name`, `last_name` は必須。
- **Transfers**: `player_id`, `from_club_id`, `to_club_id`, `transfer_date` は必須。

## 整合性ルール

1. **現在の所属**: `players.current_club_id` は、その選手の最新の契約または移籍状況と論理的に一致している必要があります（システム上の強制はないが、アプリケーションロジックで維持する）。
2. **移籍の整合性**: 移籍を行う場合、論理的には移動前のクラブに所属している必要があります。
3. **契約期間**: 一般的に契約終了日は開始日より後でなければなりません。

## 派生状態

以下の情報はエンティティの属性から計算・派生可能です。

- **年齢**: `players.date_of_birth` から現在日時を用いて算出。
- **所属期間**: `contracts.start_date` と `end_date` から算出。
- **通算成績**: 対象選手の `stats` レコードの合計値。
